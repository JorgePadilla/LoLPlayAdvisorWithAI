<div class="max-w-6xl mx-auto p-6">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900"><%= @replay.filename %></h1>
      <p class="text-gray-600 mt-2">Replay Analysis</p>
    </div>
    <div class="flex space-x-3">
      <%= link_to "Back to Replays", replays_path, 
          class: "px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors" %>
      <% if @replay.file_exists? %>
        <%= link_to watch_replay_path(@replay), 
            class: "bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center",
            title: "Open replay in League of Legends client" do %>
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path>
          </svg>
          Watch Replay
        <% end %>

      <% end %>
      <%= link_to "Delete", replay_path(@replay), method: :delete, 
          confirm: "Are you sure?", 
          class: "bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors" %>
    </div>
  </div>

  <% if @replay.processed? %>
    <!-- Game Information -->
    <div class="bg-white rounded-lg shadow mb-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-medium text-gray-900">Game Information</h2>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">üéÆ Game ID</dt>
              <dd class="mt-1 text-sm text-gray-900 font-mono"><%= @replay.game_id || @game_info&.dig('game_id') || extract_game_id_from_filename(@replay.filename) || 'N/A' %></dd>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">üåç Region</dt>
              <dd class="mt-1 text-sm text-gray-900 font-semibold"><%= @game_info&.dig('region') || extract_region_from_filename(@replay.filename) || 'N/A' %></dd>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-purple-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">‚è±Ô∏è Duration</dt>
              <dd class="mt-1 text-sm text-gray-900">
                <% if @replay.game_duration %>
                  <span class="font-semibold"><%= "#{@replay.game_duration / 60}m #{@replay.game_duration % 60}s" %></span>
                  <span class="text-gray-400 text-xs ml-1">(<%= @replay.game_duration %> seconds)</span>
                <% else %>
                  N/A
                <% end %>
              </dd>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">üîß Game Version</dt>
              <dd class="mt-1 text-sm text-gray-900 font-mono">
                <% game_version = @replay.game_version || @game_info&.dig('game_version') || 'Unknown' %>
                <% if game_version && game_version != 'Unknown' %>
                  <%= game_version %>
                <% else %>
                  <%# Fallback to current version if extraction fails %>
                  15.14.1
                <% end %>
              </dd>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">üèÜ Queue Type</dt>
              <dd class="mt-1 text-sm text-gray-900">
                <% queue_id = @game_info&.dig('queue_id') %>
                <% if queue_id == 420 %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    üèÖ Ranked Solo/Duo
                  </span>
                <% elsif queue_id == 440 %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    üèÖ Ranked Flex
                  </span>
                <% elsif queue_id == 450 %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    üéâ ARAM
                  </span>
                <% else %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    üéÆ <%= @game_info&.dig('game_mode') || 'Classic' %>
                  </span>
                <% end %>
              </dd>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Player Performance -->
    <% if @game_info && @game_info['champion_name'] %>
    <div class="bg-white shadow rounded-lg p-6 mb-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Player Performance</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <div class="text-center">
          <% if @game_info['champion_image_url'] %>
            <img src="<%= @game_info['champion_image_url'] %>" 
                 alt="<%= @game_info['champion_name'] %>" 
                 class="w-16 h-16 rounded-full mx-auto mb-2 border-2 border-blue-200"
                 onerror="this.style.display='none'">
          <% end %>
          <div class="text-2xl font-bold text-blue-600"><%= @game_info['champion_name'] %></div>
          <div class="text-sm text-gray-500">Champion</div>
          <div class="text-xs text-gray-400 mt-1">Level <%= @game_info['level'] %></div>
        </div>
        <div class="text-center">
          <!-- Victory/Defeat Item Icon -->
          <% if @game_info['win'] %>
            <!-- Victory - Trinity Force (Item ID: 3078) - Most iconic item in League -->
            <img src="https://ddragon.leagueoflegends.com/cdn/14.24.1/img/item/3078.png" 
                 alt="Trinity Force" 
                 class="w-16 h-16 rounded-full mx-auto mb-2 border-2 border-green-200"
                 onerror="this.style.display='none'">
          <% else %>
            <!-- Defeat - Dead Man's Plate (Item ID: 3742) -->
            <img src="https://ddragon.leagueoflegends.com/cdn/14.24.1/img/item/3742.png" 
                 alt="Dead Man's Plate" 
                 class="w-16 h-16 rounded-full mx-auto mb-2 border-2 border-red-200"
                 onerror="this.style.display='none'">
          <% end %>
          <div class="text-2xl font-bold <%= @game_info['win'] ? 'text-green-600' : 'text-red-600' %>">
            <%= @game_info['win'] ? 'Victory' : 'Defeat' %>
          </div>
          <div class="text-sm text-gray-500">Result</div>
          <div class="text-xs text-gray-400 mt-1"><%= @game_info['position'] %></div>
        </div>
        <div class="text-center group relative">
          <!-- KDA Sword Item Icon -->
          <img src="https://ddragon.leagueoflegends.com/cdn/14.24.1/img/item/1036.png" 
               alt="Long Sword" 
               class="w-16 h-16 rounded-full mx-auto mb-2 border-2 border-gray-200"
               onerror="this.style.display='none'">
          <div class="text-2xl font-bold text-gray-900">
            <span class="text-green-600"><%= @game_info['kills'] %></span>/<span class="text-red-600"><%= @game_info['deaths'] %></span>/<span class="text-blue-600"><%= @game_info['assists'] %></span>
          </div>
          <div class="text-sm text-gray-500 cursor-help" title="Kills/Deaths/Assists - Your combat performance">
            K/D/A
            <svg class="w-3 h-3 inline ml-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-xs text-gray-400 mt-1">
            <% kda_score = @game_info['deaths'] > 0 ? (((@game_info['kills'] + @game_info['assists']).to_f / @game_info['deaths']).round(2)) : 'Perfect' %>
            KDA: <span class="font-medium <%= kda_score == 'Perfect' ? 'text-purple-600' : kda_score.to_f >= 3.0 ? 'text-green-600' : kda_score.to_f >= 2.0 ? 'text-yellow-600' : kda_score.to_f >= 1.0 ? 'text-orange-600' : 'text-red-600' %>"><%= kda_score %></span>
            <% if kda_score != 'Perfect' %>
              <span class="text-gray-400">(
                <% if kda_score.to_f >= 3.0 %>
                  Excellent! üåü
                <% elsif kda_score.to_f >= 2.0 %>
                  Very Good! üëç
                <% elsif kda_score.to_f >= 1.0 %>
                  Good üëå
                <% else %>
                  Room for improvement üìà
                <% end %>
              )</span>
            <% else %>
              <span class="text-purple-600">(Flawless! üèÜ)</span>
            <% end %>
          </div>
          
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 w-64">
            <div class="text-center">
              <div class="font-semibold mb-1">üìä KDA Breakdown:</div>
              <div class="space-y-1 text-left">
                <div><span class="text-green-400">üó°Ô∏è Kills (<%= @game_info['kills'] %>):</span> Enemies you eliminated</div>
                <div><span class="text-red-400">üíÄ Deaths (<%= @game_info['deaths'] %>):</span> Times you were eliminated</div>
                <div><span class="text-blue-400">ü§ù Assists (<%= @game_info['assists'] %>):</span> Enemies you helped kill</div>
                <div class="border-t border-gray-700 pt-1 mt-2">
                  <span class="text-yellow-400">üìà KDA Score:</span> (Kills + Assists) √∑ Deaths<br>
                  <span class="text-xs text-gray-300">Higher is better! 1.0+ is good, 2.0+ is great, 3.0+ is excellent</span>
                </div>
              </div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
          </div>
        </div>
        <div class="text-center">
          <!-- Gold Icon -->
          <div class="w-16 h-16 rounded-full mx-auto mb-2 border-4 border-yellow-500 bg-gray-900 flex items-center justify-center shadow-lg">
            <span class="text-3xl">üí∞</span>
          </div>
          <div class="text-2xl font-bold text-yellow-600"><%= number_with_delimiter(@game_info['gold_earned']) %></div>
          <div class="text-sm text-gray-500">Gold Earned</div>
        </div>
      </div>
      
      <div class="grid grid-cols-2 md:grid-cols-3 gap-6 mt-6 pt-6 border-t border-gray-200">
        <div class="text-center group relative">
          <div class="text-xl font-semibold text-gray-900"><%= @game_info['cs'] %></div>
          <div class="text-sm text-gray-500 cursor-help" title="Creep Score - Minions and monsters you killed for gold">
            üåæ CS (Minions)
            <svg class="w-3 h-3 inline ml-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-xs text-gray-400 mt-1">
            <% cs_per_min = (@game_info['cs'].to_f / (@replay.game_duration / 60.0)).round(1) %>
            <%= cs_per_min %> CS/min
            <span class="text-gray-400">(
              <% if cs_per_min >= 8.0 %>
                Excellent! üåü
              <% elsif cs_per_min >= 6.0 %>
                Good üëç
              <% elsif cs_per_min >= 4.0 %>
                Average üëå
              <% else %>
                Focus on farming üìà
              <% end %>
            )</span>
          </div>
          
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 w-56">
            <div class="text-center">
              <div class="font-semibold mb-1">üåæ Creep Score (CS):</div>
              <div class="space-y-1 text-left">
                <div>‚Ä¢ Minions and jungle monsters killed</div>
                <div>‚Ä¢ Primary source of gold income</div>
                <div>‚Ä¢ Good CS: 6+ per minute</div>
                <div>‚Ä¢ Great CS: 8+ per minute</div>
                <div class="border-t border-gray-700 pt-1 mt-2">
                  <span class="text-yellow-400">Your rate:</span> <%= cs_per_min %> CS/min
                </div>
              </div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
          </div>
        </div>
        <div class="text-center group relative">
          <div class="text-xl font-semibold text-gray-900"><%= @game_info['vision_score'] %></div>
          <div class="text-sm text-gray-500 cursor-help" title="Vision Score - Wards placed and enemy wards destroyed">
            üëÅÔ∏è Vision Score
            <svg class="w-3 h-3 inline ml-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-xs text-gray-400 mt-1">
            <% vision_per_min = (@game_info['vision_score'].to_f / (@replay.game_duration / 60.0)).round(1) %>
            <%= vision_per_min %> per min
            <span class="text-gray-400">(
              <% if @game_info['vision_score'] >= 40 %>
                Excellent! üåü
              <% elsif @game_info['vision_score'] >= 25 %>
                Good üëç
              <% elsif @game_info['vision_score'] >= 15 %>
                Average üëå
              <% else %>
                Place more wards üìà
              <% end %>
            )</span>
          </div>
          
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 w-56">
            <div class="text-center">
              <div class="font-semibold mb-1">üëÅÔ∏è Vision Score:</div>
              <div class="space-y-1 text-left">
                <div>‚Ä¢ Wards placed for map vision</div>
                <div>‚Ä¢ Enemy wards destroyed</div>
                <div>‚Ä¢ Control wards placed</div>
                <div>‚Ä¢ Higher = better map awareness</div>
                <div class="border-t border-gray-700 pt-1 mt-2">
                  <span class="text-yellow-400">Good vision:</span> 25+ total<br>
                  <span class="text-yellow-400">Your score:</span> <%= @game_info['vision_score'] %>
                </div>
              </div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
          </div>
        </div>
        <div class="text-center group relative">
          <div class="text-xl font-semibold text-gray-900"><%= number_with_delimiter(@game_info['damage_dealt']) %></div>
          <div class="text-sm text-gray-500 cursor-help" title="Damage dealt to enemy champions in fights">
            üó°Ô∏è Damage to Champions
            <svg class="w-3 h-3 inline ml-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="text-xs text-gray-400 mt-1">
            <% damage_per_min = (@game_info['damage_dealt'].to_f / (@replay.game_duration / 60.0)).round(0) %>
            <%= number_with_delimiter(damage_per_min) %> per min
            <span class="text-gray-400">(
              <% if @game_info['damage_dealt'] >= 20000 %>
                High impact! üî•
              <% elsif @game_info['damage_dealt'] >= 15000 %>
                Good damage üëç
              <% elsif @game_info['damage_dealt'] >= 10000 %>
                Average üëå
              <% else %>
                Focus on trades üìà
              <% end %>
            )</span>
          </div>
          
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 w-56">
            <div class="text-center">
              <div class="font-semibold mb-1">üó°Ô∏è Champion Damage:</div>
              <div class="space-y-1 text-left">
                <div>‚Ä¢ Damage dealt to enemy champions</div>
                <div>‚Ä¢ Shows your fighting impact</div>
                <div>‚Ä¢ Higher = more team fight presence</div>
                <div>‚Ä¢ Varies by role and champion</div>
                <div class="border-t border-gray-700 pt-1 mt-2">
                  <span class="text-yellow-400">Your damage:</span> <%= number_with_delimiter(@game_info['damage_dealt']) %><br>
                  <span class="text-yellow-400">Per minute:</span> <%= number_with_delimiter(damage_per_min) %>
                </div>
              </div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
          </div>
        </div>
      </div>
      
      <% if @game_info['summoner_name'] && @game_info['summoner_name'] != '' %>
      <div class="mt-6 pt-6 border-t border-gray-200 text-center">
        <div class="text-lg font-medium text-gray-900">
          <%= @game_info['summoner_name'] %><% if @game_info['summoner_tag'] && @game_info['summoner_tag'] != '' %>#<%= @game_info['summoner_tag'] %><% end %>
        </div>
        <div class="text-sm text-gray-500">Summoner</div>
      </div>
      <% end %>
      
      <!-- Items Section -->
      <% if @game_info['items'] && @game_info['items'].any? %>
      <%
        # Separate items by category and sort by slot order
        main_items = @game_info['items'].select { |item| !['Consumable/Health', 'Vision/Trinket'].include?(get_item_category(item['item_id'])) }.sort_by { |item| item['slot'] }
        consumables = @game_info['items'].select { |item| get_item_category(item['item_id']) == 'Consumable/Health' }.sort_by { |item| item['slot'] }
        trinkets = @game_info['items'].select { |item| get_item_category(item['item_id']) == 'Vision/Trinket' }.sort_by { |item| item['slot'] }
      %>
      
      <div class="mt-6 pt-6 border-t border-gray-200">
        <!-- Final Build Section -->
        <% if main_items.any? %>
        <div class="mb-6">
          <h4 class="text-lg font-medium text-gray-900 mb-4 text-center">Final Build</h4>
          <div class="flex flex-wrap justify-center gap-3 mb-2">
            <% main_items.each do |item| %>
              <%= render partial: 'item_display', locals: { item: item } %>
            <% end %>
          </div>
        </div>
        <% end %>
        
        <!-- Consumables Section -->
        <% if consumables.any? %>
        <div class="mb-6">
          <h4 class="text-md font-medium text-gray-700 mb-3 text-center">Consumables</h4>
          <div class="flex flex-wrap justify-center gap-2">
            <% consumables.each do |item| %>
              <%= render partial: 'item_display', locals: { item: item, compact: true } %>
            <% end %>
          </div>
        </div>
        <% end %>
        
        <!-- Trinkets Section -->
        <% if trinkets.any? %>
        <div class="mb-6">
          <h4 class="text-md font-medium text-gray-700 mb-3 text-center">Trinkets</h4>
          <div class="flex flex-wrap justify-center gap-2">
            <% trinkets.each do |item| %>
              <%= render partial: 'item_display', locals: { item: item, compact: true } %>
            <% end %>
          </div>
        </div>
        <% end %>
        
        <div class="text-center">
          <div class="text-sm text-gray-600">
            Total Items Purchased: <span class="font-medium"><%= @game_info['items_purchased'] || 0 %></span>
          </div>
        </div>
      </div>
      <% end %>
      
      <!-- Advanced Build Analysis Section -->
      <% if @build_analysis %>
      <div class="mt-8 pt-6 border-t border-gray-200">
        <h3 class="text-xl font-bold text-gray-900 mb-6 text-center flex items-center justify-center">
          <svg class="w-6 h-6 text-purple-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          üèóÔ∏è Advanced Build Analysis
        </h3>
        
        <!-- Build Efficiency Overview -->
        <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-6 mb-6">
          <h4 class="text-lg font-semibold text-gray-900 mb-4">üìä Build Efficiency Score</h4>
          
          <!-- Final Build Items Overview -->
          <div class="mb-6">
            <h5 class="text-sm font-medium text-gray-700 mb-3">Final Build Overview:</h5>
            <div class="flex flex-wrap justify-center gap-2 mb-4">
              <% @game_info['items'].select { |item| !['Consumable/Health', 'Vision/Trinket'].include?(get_item_category(item['item_id'])) }.each do |item| %>
                <%= render partial: 'item_display', locals: { item: item, compact: true } %>
              <% end %>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="text-center group relative">
              <div class="text-3xl font-bold text-purple-600"><%= @build_analysis[:build_efficiency][:overall_score].round(1) %>/10</div>
              <div class="text-sm text-gray-600 cursor-help" title="Combined evaluation of your item build effectiveness">
                Overall Score
                <svg class="w-3 h-3 inline ml-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                </svg>
              </div>

              <!-- Tooltip -->
              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 w-64">
                <div class="text-center">
                  <div class="font-semibold mb-1">üìä Overall Build Score</div>
                  <div class="space-y-1 text-left">
                    <div>‚Ä¢ <span class="text-purple-400">Comprehensive evaluation</span> of your item build</div>
                    <div>‚Ä¢ Combines gold efficiency, timing, and adaptation</div>
                    <div>‚Ä¢ Higher scores indicate better itemization choices</div>
                    <div class="border-t border-gray-700 pt-1 mt-2">
                      <span class="text-yellow-400">Scoring:</span><br>
                      <span class="text-xs text-gray-300">8-10: Excellent üåü<br>6-8: Good üëç<br>4-6: Average üëå<br>0-4: Needs improvement üìà</span>
                    </div>
                  </div>
                </div>
                <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
              </div>
            </div>

            <div class="text-center group relative">
              <div class="text-2xl font-bold text-green-600"><%= @build_analysis[:build_efficiency][:gold_efficiency].round(0) %>%</div>
              <div class="text-sm text-gray-600 cursor-help" title="How well you converted gold into combat power">
                Gold Efficiency
                <svg class="w-3 h-3 inline ml-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                </svg>
              </div>

              <!-- Tooltip -->
              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 w-64">
                <div class="text-center">
                  <div class="font-semibold mb-1">üí∞ Gold Efficiency</div>
                  <div class="space-y-1 text-left">
                    <div>‚Ä¢ <span class="text-green-400">Value for gold spent</span> on items</div>
                    <div>‚Ä¢ Measures how well gold converts to stats</div>
                    <div>‚Ä¢ Considers item cost vs. stat value</div>
                    <div class="border-t border-gray-700 pt-1 mt-2">
                      <span class="text-yellow-400">Scoring:</span><br>
                      <span class="text-xs text-gray-300">90%+: Excellent üåü<br>80-90%: Good üëç<br>70-80%: Average üëå<br>Below 70%: Needs improvement üìà</span>
                    </div>
                  </div>
                </div>
                <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
              </div>
            </div>

            <div class="text-center group relative">
              <div class="text-2xl font-bold text-blue-600"><%= @build_analysis[:build_efficiency][:timing_score].round(1) %>/10</div>
              <div class="text-sm text-gray-600 cursor-help" title="How well you timed your item purchases">
                Timing Score
                <svg class="w-3 h-3 inline ml-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                </svg>
              </div>

              <!-- Tooltip -->
              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 w-64">
                <div class="text-center">
                  <div class="font-semibold mb-1">‚è±Ô∏è Timing Score</div>
                  <div class="space-y-1 text-left">
                    <div>‚Ä¢ <span class="text-blue-400">Strategic timing</span> of item purchases</div>
                    <div>‚Ä¢ Early power spikes vs. delayed purchases</div>
                    <div>‚Ä¢ Component vs. completed item timing</div>
                    <div class="border-t border-gray-700 pt-1 mt-2">
                      <span class="text-yellow-400">Scoring:</span><br>
                      <span class="text-xs text-gray-300">8-10: Excellent timing üåü<br>6-8: Good timing üëç<br>4-6: Average timing üëå<br>0-4: Poor timing üìà</span>
                    </div>
                  </div>
                </div>
                <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
              </div>
            </div>

            <div class="text-center group relative">
              <div class="text-2xl font-bold text-orange-600"><%= @build_analysis[:build_efficiency][:adaptation_score].round(1) %>/10</div>
              <div class="text-sm text-gray-600 cursor-help" title="How well you adapted your build to the game situation">
                Adaptation
                <svg class="w-3 h-3 inline ml-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                </svg>
              </div>

              <!-- Tooltip -->
              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 w-64">
                <div class="text-center">
                  <div class="font-semibold mb-1">üéØ Build Adaptation</div>
                  <div class="space-y-1 text-left">
                    <div>‚Ä¢ <span class="text-orange-400">Situational awareness</span> in item choices</div>
                    <div>‚Ä¢ Counter-building vs. enemy composition</div>
                    <div>‚Ä¢ Adapting to game state (ahead/behind)</div>
                    <div class="border-t border-gray-700 pt-1 mt-2">
                      <span class="text-yellow-400">Scoring:</span><br>
                      <span class="text-xs text-gray-300">8-10: Excellent adaptation üåü<br>6-8: Good adaptation üëç<br>4-6: Average adaptation üëå<br>0-4: Poor adaptation üìà</span>
                    </div>
                  </div>
                </div>
                <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Build Timeline -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
          <div class="px-6 py-4 border-b border-gray-200">
            <h4 class="text-lg font-semibold text-gray-900 flex items-center">
              <svg class="w-5 h-5 text-indigo-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
              </svg>
              ‚è±Ô∏è Build Timeline & Component Analysis
            </h4>
            <p class="text-sm text-gray-600 mt-1">Your itemization journey from components to completed items</p>
          </div>
          <div class="p-6">
            <% 
              # Create a unified chronological timeline
              timeline_items = []
              grouped_events = {}
              
              # First, group components with their completions
              @build_analysis[:build_timeline].each do |event|
                if event[:type] == 'component'
                  final_item_id = event[:leads_to]
                  grouped_events[final_item_id] ||= { components: [], completion: nil }
                  grouped_events[final_item_id][:components] << event
                elsif event[:type] == 'completion'
                  item_id = event[:item_id]
                  grouped_events[item_id] ||= { components: [], completion: nil }
                  grouped_events[item_id][:completion] = event
                elsif event[:type] == 'simple_purchase'
                  # Add simple purchases directly to timeline
                  timeline_items << {
                    type: 'simple_purchase',
                    time: event[:time],
                    event: event
                  }
                end
              end
              
              # Add grouped builds to timeline (use completion time for sorting)
              grouped_events.each do |item_id, group|
                next unless group[:completion]
                timeline_items << {
                  type: 'grouped_build',
                  time: group[:completion][:time],
                  group: group
                }
              end
              
              # Sort everything chronologically
              timeline_items.sort_by! { |item| item[:time] }
            %>
            
            <div class="space-y-6">
              <% timeline_items.each do |timeline_item| %>
                <% if timeline_item[:type] == 'grouped_build' %>
                  <% group = timeline_item[:group] %>
                  <!-- Grouped Item Build -->
                  <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-blue-200 p-6">
                    <!-- Item Header -->
                    <div class="flex items-center justify-between mb-4">
                      <div class="flex items-center space-x-4">
                        <div class="relative">
                          <img src="<%= group[:completion][:image_url] %>" 
                               alt="<%= group[:completion][:item_name] %>" 
                               class="w-16 h-16 rounded-xl border-3 border-green-400 bg-white shadow-lg"
                               onerror="this.style.display='none'">
                          <!-- Completion Badge -->
                          <div class="absolute -top-2 -right-2 w-7 h-7 bg-green-500 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                          </div>
                        </div>
                        <div>
                          <h5 class="text-xl font-bold text-gray-900"><%= group[:completion][:item_name] %></h5>
                          <div class="flex items-center space-x-4 text-sm">
                            <span class="text-green-600 font-semibold">
                              <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                              </svg>
                              Completed: <%= group[:completion][:time_formatted] %>
                            </span>
                            <span class="text-yellow-600 font-semibold">
                              <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-7-8a7 7 0 1114 0 7 7 0 01-14 0z" clip-rule="evenodd"></path>
                              </svg>
                              <%= number_with_delimiter(group[:completion][:cost]) %>g combine cost
                            </span>
                            <% if group[:completion][:power_spike] == 'major' %>
                              <span class="text-red-500 font-bold">üî• Major Power Spike</span>
                            <% elsif group[:completion][:power_spike] == 'moderate' %>
                              <span class="text-orange-500 font-medium">‚ö° Power Spike</span>
                            <% end %>
                          </div>
                        </div>
                      </div>
                      <div class="text-right">
                        <div class="text-sm font-bold text-green-600">‚úì COMPLETE</div>
                        <div class="text-xs text-gray-500">Slot <%= group[:completion][:slot] + 1 %></div>
                      </div>
                    </div>
                    
                    <!-- Component Build Path -->
                    <% if group[:components].any? %>
                      <div class="bg-white rounded-lg p-4 border border-blue-200">
                        <h6 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
                          <svg class="w-4 h-4 text-blue-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                          </svg>
                          Build Path (<%= group[:components].length %> components)
                        </h6>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                          <% group[:components].sort_by { |c| c[:time] }.each_with_index do |component, index| %>
                            <div class="flex items-center space-x-3 p-3 bg-blue-50 rounded-lg border border-blue-200">
                              <div class="flex-shrink-0">
                                <img src="<%= component[:image_url] %>" 
                                     alt="<%= component[:item_name] %>" 
                                     class="w-10 h-10 rounded-lg border-2 border-blue-300 bg-white"
                                     onerror="this.style.display='none'">
                              </div>
                              <div class="flex-1 min-w-0">
                                <h7 class="font-medium text-gray-900 text-sm truncate"><%= component[:item_name] %></h7>
                                <div class="text-xs text-gray-600">
                                  <span class="text-blue-600 font-medium"><%= component[:time_formatted] %></span>
                                  <span class="mx-1">‚Ä¢</span>
                                  <span class="text-yellow-600 font-medium"><%= number_with_delimiter(component[:cost]) %>g</span>
                                </div>
                              </div>
                              <div class="text-xs text-blue-600 font-semibold">
                                #<%= index + 1 %>
                              </div>
                            </div>
                          <% end %>
                        </div>
                      </div>
                    <% end %>
                  </div>
                  
                <% elsif timeline_item[:type] == 'simple_purchase' %>
                  <% purchase = timeline_item[:event] %>
                  <!-- Direct Purchase -->
                  <div class="bg-gray-50 rounded-xl border border-gray-200 p-6">
                    <div class="flex items-center space-x-6">
                      <div class="flex-shrink-0">
                        <div class="relative">
                          <img src="<%= purchase[:image_url] %>" 
                               alt="<%= purchase[:item_name] %>" 
                               class="w-16 h-16 rounded-xl border-2 border-gray-400 bg-white shadow-lg"
                               onerror="this.style.display='none'">
                          <!-- Direct Purchase Badge -->
                          <div class="absolute -top-2 -right-2 w-7 h-7 bg-gray-500 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                              <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zM8 6a2 2 0 114 0v1H8V6z" clip-rule="evenodd"></path>
                            </svg>
                          </div>
                        </div>
                      </div>
                      <div class="flex-1">
                        <h5 class="text-xl font-bold text-gray-900"><%= purchase[:item_name] %></h5>
                        <div class="flex items-center space-x-4 text-sm">
                          <span class="text-blue-600 font-semibold">
                            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                            Purchased: <%= purchase[:time_formatted] %>
                          </span>
                          <span class="text-yellow-600 font-semibold">
                            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                              <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-7-8a7 7 0 1114 0 7 7 0 01-14 0z" clip-rule="evenodd"></path>
                            </svg>
                            <%= number_with_delimiter(purchase[:cost]) %>g direct cost
                          </span>
                          <span class="text-gray-600 font-semibold">
                            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                              <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zM8 6a2 2 0 114 0v1H8V6z" clip-rule="evenodd"></path>
                            </svg>
                            Direct Purchase
                          </span>
                          <% if purchase[:power_spike] == 'major' %>
                            <span class="text-red-500 font-bold">üî• Major Power Spike</span>
                          <% elsif purchase[:power_spike] == 'moderate' %>
                            <span class="text-orange-500 font-medium">‚ö° Power Spike</span>
                          <% end %>
                        </div>
                      </div>
                      <div class="text-right">
                        <div class="text-sm font-bold text-gray-600">‚úì PURCHASED</div>
                        <div class="text-xs text-gray-500">Slot <%= purchase[:slot] + 1 %></div>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
        
        <!-- Situational Analysis -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- Enemy Composition Analysis -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
              <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                <svg class="w-5 h-5 text-red-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                üéØ Enemy Team Analysis
              </h4>
            </div>
            <div class="p-6">
              <% enemy_comp = @build_analysis[:situational_analysis][:enemy_composition] %>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">üõ°Ô∏è Tanks:</span>
                  <span class="font-medium"><%= enemy_comp[:tanks] || 0 %></span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">üó°Ô∏è Assassins:</span>
                  <span class="font-medium"><%= enemy_comp[:assassins] || 0 %></span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">üîÆ Mages:</span>
                  <span class="font-medium"><%= enemy_comp[:mages] || 0 %></span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">üèπ ADCs:</span>
                  <span class="font-medium"><%= enemy_comp[:adcs] || 0 %></span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">üíö Supports:</span>
                  <span class="font-medium"><%= enemy_comp[:supports] || 0 %></span>
                </div>
              </div>
              
              <!-- Missing Counters -->
              <% if @build_analysis[:situational_analysis][:missing_counters].any? %>
                <div class="mt-4 pt-4 border-t border-gray-200">
                  <h5 class="text-sm font-medium text-red-600 mb-2">‚ö†Ô∏è Missing Counters:</h5>
                  <% @build_analysis[:situational_analysis][:missing_counters].each do |counter| %>
                    <div class="text-sm text-gray-600 mb-1">
                      <span class="font-medium"><%= counter[:item] %></span> - <%= counter[:reason] %>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
          
          <!-- Game State Context -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
              <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                <svg class="w-5 h-5 text-blue-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                </svg>
                üìà Game State Context
              </h4>
            </div>
            <div class="p-6">
              <% game_state = @build_analysis[:situational_analysis][:game_state_context] %>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">üí∞ Gold Position:</span>
                  <span class="font-medium capitalize 
                    <%= game_state[:gold_advantage] == 'ahead' ? 'text-green-600' : 
                        game_state[:gold_advantage] == 'behind' ? 'text-red-600' : 'text-yellow-600' %>">
                    <%= game_state[:gold_advantage] %>
                  </span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">‚öîÔ∏è KDA Performance:</span>
                  <span class="font-medium capitalize 
                    <%= game_state[:kda_performance] == 'positive' ? 'text-green-600' : 'text-red-600' %>">
                    <%= game_state[:kda_performance] %>
                  </span>
                </div>
              </div>
              
              <% item_adapt = @build_analysis[:situational_analysis][:item_adaptation] %>
              <div class="mt-4 pt-4 border-t border-gray-200">
                <h5 class="text-sm font-medium text-gray-700 mb-2">Item Distribution:</h5>
                <div class="space-y-2">
                  <div class="flex justify-between text-sm">
                    <span class="text-gray-600">üó°Ô∏è Offensive:</span>
                    <span class="font-medium"><%= item_adapt[:offensive_items] %></span>
                  </div>
                  <div class="flex justify-between text-sm">
                    <span class="text-gray-600">üõ°Ô∏è Defensive:</span>
                    <span class="font-medium"><%= item_adapt[:defensive_items] %></span>
                  </div>
                  <div class="flex justify-between text-sm">
                    <span class="text-gray-600">üîß Utility:</span>
                    <span class="font-medium"><%= item_adapt[:utility_items] %></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Pro Comparison -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
          <div class="px-6 py-4 border-b border-gray-200">
            <h4 class="text-lg font-semibold text-gray-900 flex items-center">
              <svg class="w-5 h-5 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
              </svg>
              üèÜ Pro Player Comparison
            </h4>
          </div>
          <div class="p-6">
            <% pro_comp = @build_analysis[:pro_comparison] %>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="text-center">
                <h5 class="text-sm font-medium text-gray-700 mb-2">Your Timing</h5>
                <div class="space-y-1">
                  <div class="text-lg font-bold text-blue-600"><%= pro_comp[:your_timing][:first_item] %></div>
                  <div class="text-sm text-gray-500">1st Item</div>
                </div>
              </div>
              <div class="text-center">
                <h5 class="text-sm font-medium text-gray-700 mb-2">Pro Average</h5>
                <div class="space-y-1">
                  <div class="text-lg font-bold text-green-600"><%= pro_comp[:pro_average][:first_item] %></div>
                  <div class="text-sm text-gray-500">1st Item</div>
                </div>
              </div>
              <div class="text-center">
                <h5 class="text-sm font-medium text-gray-700 mb-2">Pro Best</h5>
                <div class="space-y-1">
                  <div class="text-lg font-bold text-purple-600"><%= pro_comp[:pro_best][:first_item] %></div>
                  <div class="text-sm text-gray-500">1st Item</div>
                </div>
              </div>
            </div>
            <div class="mt-4 text-center">
              <div class="text-sm text-gray-600">
                Your build timing ranks in the <span class="font-bold text-indigo-600"><%= pro_comp[:rank_percentile] %>th percentile</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Improvement Suggestions -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
          <div class="px-6 py-4 border-b border-gray-200">
            <h4 class="text-lg font-semibold text-gray-900 flex items-center">
              <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
              üí° Item-Specific Analysis
            </h4>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <% @build_analysis[:improvement_suggestions].each do |suggestion| %>
                <div class="border border-gray-200 rounded-lg p-4">
                  <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 flex items-center space-x-2">
                      <!-- Item Image -->
                      <% 
                        # Find the item from the game_info items array
                        suggestion_item = @game_info['items'].find { |item| item['name'] == suggestion[:item] }
                        item_image_url = suggestion_item&.dig('image_url')
                      %>
                      <% if item_image_url %>
                        <img src="<%= item_image_url %>" 
                             alt="<%= suggestion[:item] %>" 
                             class="w-10 h-10 rounded-lg border border-gray-300 bg-white"
                             onerror="this.style.display='none'">
                      <% end %>
                      <!-- Info Icon -->
                      <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                        <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                      </div>
                    </div>
                    <div class="flex-1">
                      <h5 class="font-medium text-gray-900"><%= suggestion[:item] %></h5>
                      <p class="text-sm text-gray-600 mt-1"><%= suggestion[:suggestion] %></p>
                      <p class="text-xs text-gray-500 mt-2">Impact: <%= suggestion[:impact] %></p>
                    </div>
                    <div class="flex-shrink-0">
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                        <%= suggestion[:timing] == 'Good' ? 'bg-green-100 text-green-800' : 
                            suggestion[:timing] == 'Questionable' ? 'bg-yellow-100 text-yellow-800' : 
                            'bg-red-100 text-red-800' %>">
                        <%= suggestion[:timing] %>
                      </span>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
        
        <!-- Learning Insights -->
        <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6">
          <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <svg class="w-5 h-5 text-indigo-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"></path>
            </svg>
            üéì Key Learning Points
          </h4>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Critical Mistakes -->
            <div>
              <h5 class="font-medium text-red-700 mb-3 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                ‚ùå Critical Mistakes:
              </h5>
              <ul class="space-y-2">
                <% @build_analysis[:learning_insights][:critical_mistakes].each do |mistake| %>
                  <li class="text-sm text-gray-700 flex items-start">
                    <span class="text-red-500 mr-2">‚Ä¢</span>
                    <%= mistake %>
                  </li>
                <% end %>
              </ul>
            </div>
            
            <!-- Excellent Decisions -->
            <div>
              <h5 class="font-medium text-green-700 mb-3 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                ‚úÖ Excellent Decisions:
              </h5>
              <ul class="space-y-2">
                <% @build_analysis[:learning_insights][:excellent_decisions].each do |decision| %>
                  <li class="text-sm text-gray-700 flex items-start">
                    <span class="text-green-500 mr-2">‚Ä¢</span>
                    <%= decision %>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
          
          <!-- Next Game Improvements -->
          <div class="mt-6 pt-6 border-t border-gray-200">
            <h5 class="font-medium text-indigo-700 mb-3 flex items-center">
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
              </svg>
              üéØ Next Game Improvements:
            </h5>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <% @build_analysis[:learning_insights][:next_game_improvements].each do |improvement| %>
                <div class="bg-white rounded-lg p-3 border border-indigo-200">
                  <p class="text-sm text-gray-700 flex items-start">
                    <span class="text-indigo-500 mr-2">‚Üí</span>
                    <%= improvement %>
                  </p>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <% end %>
    </div>
    <% end %>

    <!-- AI Match Analysis -->
    <% if @ai_analysis %>
    <div class="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-6 mb-6">
      <div class="flex items-center mb-4">
        <div class="flex-shrink-0">
          <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-lg font-medium text-purple-900">ü§ñ AI Match Analysis</h3>
          <p class="text-sm text-purple-700">Performance: <%= @ai_analysis[:performance_score] %>/100 | Win Probability: <%= @ai_analysis[:win_probability] %>%</p>
        </div>
      </div>
      
      <!-- AI Summary -->
      <div class="bg-white rounded-lg p-4 mb-4">
        <h4 class="text-md font-medium text-gray-900 mb-2">üìã AI Summary:</h4>
        <blockquote class="text-gray-700 italic border-l-4 border-purple-300 pl-4">
          <%= @ai_analysis[:summary] %>
        </blockquote>
      </div>
      
      <!-- Suggestions -->
      <% if @ai_analysis[:suggestions].any? %>
      <div class="bg-white rounded-lg p-4 mb-4">
        <h4 class="text-md font-medium text-gray-900 mb-3">üìå Suggestions:</h4>
        <div class="space-y-2">
          <% @ai_analysis[:suggestions].each do |suggestion| %>
            <div class="flex items-start space-x-3 p-2 rounded <%= suggestion[:type] == 'warning' ? 'bg-yellow-50' : 'bg-blue-50' %>">
              <span class="text-lg"><%= suggestion[:icon] %></span>
              <div class="flex-1">
                <p class="text-sm text-gray-800"><%= suggestion[:message] %></p>
                <p class="text-xs text-gray-500 mt-1"><%= suggestion[:timestamp] %></p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <% end %>
      
      <!-- Timeline Events -->
      <% if @ai_analysis[:timeline_events].any? %>
      <div class="bg-white rounded-lg p-4">
        <h4 class="text-md font-medium text-gray-900 mb-3">üìà Match Timeline:</h4>
        <div class="flex flex-wrap gap-2">
          <% @ai_analysis[:timeline_events].each do |event| %>
            <div class="flex items-center space-x-2 px-3 py-2 rounded-full text-sm <%= 
              case event[:type]
              when 'positive' then 'bg-green-100 text-green-800'
              when 'negative' then 'bg-red-100 text-red-800'
              else 'bg-gray-100 text-gray-800'
              end
            %>">
              <span><%= event[:icon] %></span>
              <span class="font-medium">[<%= event[:time] %>]</span>
              <span><%= event[:description] %></span>
            </div>
          <% end %>
        </div>
      </div>
      <% end %>
    </div>
    <% end %>

    <!-- Team Composition -->
    <% if (@blue_team && @blue_team.any?) || (@red_team && @red_team.any?) %>
    <div class="bg-white rounded-lg shadow mb-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-medium text-gray-900 flex items-center">
          <svg class="w-5 h-5 text-indigo-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
          </svg>
          üë• Team Composition
        </h2>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          
          <!-- Blue Team (Winners) -->
          <% if @blue_team.any? %>
          <div class="bg-blue-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
              üü¶ Blue Team 
              <% if @blue_team.first && @blue_team.first['win'] %>
                <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  ‚úÖ Victory
                </span>
              <% end %>
            </h3>
            <div class="space-y-3">
              <% @blue_team.each do |player| %>
                <div class="bg-white rounded-lg p-3 flex items-center space-x-4">
                  <% if player['champion'] %>
                    <div class="relative">
                      <img src="<%= AccurateRoflParser.get_champion_image_url(player['champion']) %>"
                           alt="<%= player['champion'] %>"
                           class="w-10 h-10 rounded-full border-2 border-blue-200"
                           onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                      <div class="w-10 h-10 rounded-full border-2 border-blue-200 bg-gray-100 flex items-center justify-center hidden">
                        <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                        </svg>
                      </div>
                    </div>
                  <% end %>
                  <div class="flex-1">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="font-medium text-gray-900"><%= player['summoner_name'] %><% if player['summoner_tag'] && player['summoner_tag'] != '' %>#<%= player['summoner_tag'] %><% end %></p>
                        <p class="text-sm text-gray-600"><%= player['champion'] %> (<%= player['position'] %>)</p>
                      </div>
                      <div class="text-right">
                        <p class="text-sm font-medium text-gray-900"><%= player['kills'] %>/<%= player['deaths'] %>/<%= player['assists'] %></p>
                        <p class="text-xs text-gray-500">Level <%= player['level'] %></p>
                      </div>
                    </div>
                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                      <span>üí∞ <%= number_with_delimiter(player['gold_earned']) %>g</span>
                      <span>üó°Ô∏è <%= number_with_delimiter(player['damage_dealt']) %></span>
                      <span>üåæ <%= player['cs'] %> CS</span>
                      <span>üëÅÔ∏è <%= player['vision_score'] %></span>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
          <% end %>
          
          <!-- Red Team (Losers) -->
          <% if @red_team.any? %>
          <div class="bg-red-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-red-800 mb-4 flex items-center">
              üü• Red Team
              <% if @red_team.first && !@red_team.first['win'] %>
                <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  ‚ùå Defeat
                </span>
              <% end %>
            </h3>
            <div class="space-y-3">
              <% @red_team.each do |player| %>
                <div class="bg-white rounded-lg p-3 flex items-center space-x-4">
                  <% if player['champion'] %>
                    <div class="relative">
                      <img src="<%= AccurateRoflParser.get_champion_image_url(player['champion']) %>"
                           alt="<%= player['champion'] %>"
                           class="w-10 h-10 rounded-full border-2 border-red-200"
                           onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                      <div class="w-10 h-10 rounded-full border-2 border-red-200 bg-gray-100 flex items-center justify-center hidden">
                        <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                        </svg>
                      </div>
                    </div>
                  <% end %>
                  <div class="flex-1">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="font-medium text-gray-900"><%= player['summoner_name'] %><% if player['summoner_tag'] && player['summoner_tag'] != '' %>#<%= player['summoner_tag'] %><% end %></p>
                        <p class="text-sm text-gray-600"><%= player['champion'] %> (<%= player['position'] %>)</p>
                      </div>
                      <div class="text-right">
                        <p class="text-sm font-medium text-gray-900"><%= player['kills'] %>/<%= player['deaths'] %>/<%= player['assists'] %></p>
                        <p class="text-xs text-gray-500">Level <%= player['level'] %></p>
                      </div>
                    </div>
                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                      <span>üí∞ <%= number_with_delimiter(player['gold_earned']) %>g</span>
                      <span>üó°Ô∏è <%= number_with_delimiter(player['damage_dealt']) %></span>
                      <span>üåæ <%= player['cs'] %> CS</span>
                      <span>üëÅÔ∏è <%= player['vision_score'] %></span>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
          <% end %>
          
        </div>
      </div>
    </div>
    <% end %>

    <!-- Match Summary -->
    <% if @match_summary %>
    <div class="bg-white rounded-lg shadow mb-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-medium text-gray-900 flex items-center">
          <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          üìä Match Summary
        </h2>
      </div>
      
      <div class="p-6">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
          <div class="text-center">
            <div class="text-2xl font-bold text-green-600"><%= @match_summary[:team_kills] %></div>
            <div class="text-sm text-gray-500">Team Kills</div>
            <div class="text-xs text-gray-400">vs <%= @match_summary[:enemy_kills] %> enemy</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-blue-600"><%= @match_summary[:kda_ratio] %></div>
            <div class="text-sm text-gray-500">Team KDA</div>
            <div class="text-xs text-gray-400">(<%= @match_summary[:team_kills] %>+<%= @match_summary[:team_assists] %>)/<%= @match_summary[:team_deaths] %></div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-yellow-600"><%= number_with_delimiter(@match_summary[:team_gold]) %>g</div>
            <div class="text-sm text-gray-500">Team Gold</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold <%= @match_summary[:match_result] == 'Victory' ? 'text-green-600' : 'text-red-600' %>"><%= @match_summary[:match_result] %></div>
            <div class="text-sm text-gray-500">Match Result</div>
            <div class="text-xs text-gray-400"><%= @match_summary[:match_intensity][:description] %></div>
          </div>
        </div>
      </div>
    </div>
    <% end %>

    <!-- Player Highlights -->
    <% if @player_highlights&.any? %>
    <div class="bg-white rounded-lg shadow mb-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-medium text-gray-900 flex items-center">
          <svg class="w-5 h-5 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
          </svg>
          üåü Player Highlights
        </h2>
      </div>
      
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% @player_highlights.each do |highlight| %>
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <h3 class="font-medium text-gray-900"><%= highlight[:title] %></h3>
                <span class="text-lg font-bold text-indigo-600"><%= highlight[:value] %></span>
              </div>
              <div class="text-sm text-gray-700">
                <strong><%= highlight[:player] %></strong> 
                <% if highlight[:champion] %>
                  (<%= highlight[:champion] %>)
                <% end %>
              </div>
              <div class="text-xs text-gray-500 mt-1"><%= highlight[:description] %></div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <% end %>

    <!-- Match Timeline -->
    <% if @timeline_data && @timeline_data[:duration] && @timeline_data[:duration] > 0 %>
    <div class="bg-white rounded-lg shadow mb-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-medium text-gray-900 flex items-center">
          <svg class="w-5 h-5 text-indigo-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path>
          </svg>
          ‚è±Ô∏è Match Timeline - <%= @timeline_data[:duration_formatted] %>
        </h2>
      </div>
      
      <div class="p-6">
        <!-- Timeline Bar -->
        <div class="relative mb-6">
          <div class="w-full h-8 bg-gray-200 rounded-lg overflow-hidden flex">
            <% @timeline_data[:phases].each do |phase| %>
              <% width_percent = ((phase[:end] - phase[:start]).to_f / @timeline_data[:duration] * 100).round(1) %>
              <div class="<%= phase[:color] %> h-full flex items-center justify-center text-white text-xs font-medium"
                   style="width: <%= width_percent %>%"
                   title="<%= phase[:name] %>: <%= format_duration(phase[:start]) %> - <%= format_duration(phase[:end]) %>">
                <%= phase[:name] %>
              </div>
            <% end %>
          </div>
          
          <!-- Timeline markers -->
          <div class="absolute top-10 w-full">
            <% [0, @timeline_data[:duration] * 0.25, @timeline_data[:duration] * 0.5, @timeline_data[:duration] * 0.75, @timeline_data[:duration]].each do |time| %>
              <% position_percent = (time.to_f / @timeline_data[:duration] * 100).round(1) %>
              <div class="absolute text-xs text-gray-500" style="left: <%= position_percent %>%; transform: translateX(-50%)">
                <%= format_duration(time.to_i) %>
              </div>
            <% end %>
          </div>
        </div>
        
        <!-- Instructions -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex items-start">
            <svg class="w-5 h-5 text-blue-500 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
            <div class="text-sm text-blue-800">
              <p class="font-medium mb-1">üé¨ To watch the victory video:</p>
              <p>Click "Watch Replay" above to open in League of Legends client, then fast-forward to <%= @timeline_data[:duration_formatted] %> to see the victory screen!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <% end %>

    <!-- Players Information section removed - replaced by enhanced Team Composition above -->



  <% else %>
    <!-- Processing Status -->
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-yellow-800">Replay Processing</h3>
          <div class="mt-2 text-sm text-yellow-700">
            <p>This replay is currently being processed. Please check back in a moment.</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- File Information -->
    <div class="bg-white rounded-lg shadow mt-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-medium text-gray-900">File Information</h2>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <dt class="text-sm font-medium text-gray-500">Filename</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @replay.filename %></dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">File Size</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= number_to_human_size(@replay.file_size) %></dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Uploaded</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= time_ago_in_words(@replay.created_at) %> ago</dd>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
